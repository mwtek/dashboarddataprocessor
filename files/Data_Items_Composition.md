# Covid

## General queries

The following queries are used at the beginning of a run to determine the patient/encounter pool.

### Retrieval input criteria

 	1) [base]/Condition?code=U07.1&_pretty=false&date=ge2020-01-27&_count=500
    2) [base]/Observation?code=94640-0,94306-8,96763-8,94500-6,96895-8,96741-4&date=ge2020-01-27

### Further data retrieval

    3) [base]/Patient?_id=[ids_from_1_and_2]
    4) [base]/Encounter?subject=[ids_from_3]&date=ge2020-01-27
    5) [base]/Location?_id=[ids_from_4]
    6) [base]/Procedure?code=26763009,243147009,[...],19647005&subject=[ids_from_1_and_2]

## Data items composition

Most of the items just rely on data with at least one positive covid lab finding or diagnosis.

For all items that require the `Versorgungsstellenkontakt`, it is important that either the visit
number (`Encounter.identifier.value` while `Encounter.identifier.type.coding.code` = `VN` is present
in all encounters, or alternatively can be navigated through the hierarchy via
`Encounter.partOf` (not recommended due to inefficiency).

| Item name                            | FHIR attributes                                                                         | Forced Condition                             | Separation criterium                                                                                                                                                                                                                                                              |
|--------------------------------------|-----------------------------------------------------------------------------------------|----------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `current.treatmentlevel`             | Encounter.location                                                                      |                                              | referenced `Location.type` = `ICU`                                                                                                                                                                                                                                                |
|                                      | Encounter.status                                                                        | `IN-PROGRESS`                                |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.type                                                                          | `Versorgungsstellenkontakt`                  |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.class                                                                         | `IMP`                                        |                                                                                                                                                                                                                                                                                   |    
|                                      | Procedure.code                                                                          |                                              | `code` from [VENTILATION](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-procedure-beatmung-snomed)/[ECMO](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-extrakorporale-verfahren) value set |
|                                      | Procedure.status                                                                        |                                              | `IN-PROGRESS`, `FINISHED`                                                                                                                                                                                                                                                         |
| `current.maxtreatmentlevel`          | Encounter.location                                                                      |                                              | referenced `Location.type` = `ICU`                                                                                                                                                                                                                                                |
|                                      | Encounter.status                                                                        | `IN-PROGRESS`                                |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.type                                                                          | `Versorgungsstellenkontakt`                  |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.class                                                                         | `IMP`                                        |                                                                                                                                                                                                                                                                                   |
|                                      | Procedure.code                                                                          |                                              | `code` from [VENTILATION](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-procedure-beatmung-snomed)/[ECMO](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-extrakorporale-verfahren) value set |
| `current.age.maxtreatmentlevel.*`    | Encounter.location                                                                      |                                              | referenced `Location.type` = `ICU`                                                                                                                                                                                                                                                |
|                                      | Encounter.status                                                                        | `IN-PROGRESS`                                |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.type                                                                          | `Versorgungsstellenkontakt`                  |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.class                                                                         | `IMP`                                        |                                                                                                                                                                                                                                                                                   |
|                                      | Procedure.code                                                                          |                                              | `code` from [VENTILATION](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-procedure-beatmung-snomed)/[ECMO](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-extrakorporale-verfahren) value set |                           
|                                      | Patient.birthDate                                                                       |                                              |                                                                                                                                                                                                                                                                                   |
| `cumulative.results`                 | Observation.effective                                                                   | younger than kick-off-date                   |                                                                                                                                                                                                                                                                                   |
|                                      | Observation.code                                                                        | IN (`94640-0`,`94306-8`,`96763-8`,`94500-6`) |                                                                                                                                                                                                                                                                                   |
|                                      | Observation.valueCodeableConcept                                                        |                                              | [MII value set](https://simplifier.net/medizininformatikinitiative-modullabor/valuesetqualitativelaborergebnisse)                                                                                                                                                                 |
| `cumulative.gender`                  | Patient.gender                                                                          |                                              | [MII AdministrativeGender value set](https://simplifier.net/packages/hl7.fhir.r4.core/4.0.1/files/80273)                                                                                                                                                                          |
| `cumulative.age`                     | Patient.birthDate                                                                       |                                              |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.period.start                                                                  |                                              |                                                                                                                                                                                                                                                                                   |
| `cumulative.maxtreatmentlevel`       | Encounter.location                                                                      |                                              | referenced `Location.type` = `ICU`                                                                                                                                                                                                                                                |
|                                      | Encounter.type                                                                          | `Versorgungsstellenkontakt`                  | `IN-PROGRESS`, `FINISHED`                                                                                                                                                                                                                                                         |
|                                      | Encounter.class                                                                         | `IMP`                                        |                                                                                                                                                                                                                                                                                   |
|                                      | Procedure.code                                                                          |                                              | `code` from [VENTILATION](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-procedure-beatmung-snomed)/[ECMO](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-extrakorporale-verfahren) value set |
| `cumulative.zipcode`                 | Patient.address.postalCode                                                              |                                              |                                                                                                                                                                                                                                                                                   |
|                                      | Patient.address.country                                                                 |                                              | `DE` or not                                                                                                                                                                                                                                                                       |
| `cumulative.inpatient.gender`        | Patient.gender                                                                          |                                              | [MII AdministrativeGender value set](https://simplifier.net/packages/hl7.fhir.r4.core/4.0.1/files/80273)                                                                                                                                                                          |
|                                      | Encounter.class                                                                         | `IMP`                                        |                                                                                                                                                                                                                                                                                   |
| `cumulative.outpatient.gender`       | Patient.gender                                                                          |                                              | [MII AdministrativeGender value set](https://simplifier.net/packages/hl7.fhir.r4.core/4.0.1/files/80273)                                                                                                                                                                          |
|                                      | Encounter.class                                                                         | `AMB`                                        |                                                                                                                                                                                                                                                                                   |
| `cumulative.inpatient.age`           | Patient.birthDate                                                                       |                                              |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.type                                                                          | `Einrichtungskontakt`                        |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.period.start                                                                  |                                              |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.class                                                                         | `IMP`                                        |                                                                                                                                                                                                                                                                                   |
| `cumulative.outpatient.age`          | Patient.birthDate                                                                       |                                              |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.type                                                                          | `Einrichtungskontakt`                        |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.period.start                                                                  |                                              |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.class                                                                         | `AMB`                                        |                                                                                                                                                                                                                                                                                   |
| `cumulative.lengthofstay.icu.*`      | Encounter.location                                                                      |                                              | referenced `Location.type` = `ICU`                                                                                                                                                                                                                                                |
|                                      | Encounter.location.period / Encounter.period                                            |                                              |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.type                                                                          | `Versorgungsstellenkontakt`                  |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.hospitalization.dischargeDisposition<br>.EntlassungsgrundErsteUndZweiteStelle |                                              | `07`                                                                                                                                                                                                                                                                              |
| `cumulative.lengthofstay.hospital.*` | Encounter.type                                                                          | `Einrichtungskontakt`                        |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.period                                                                        |                                              |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.hospitalization.dischargeDisposition<br>.EntlassungsgrundErsteUndZweiteStelle |                                              | `07`                                                                                                                                                                                                                                                                              |
| `cumulative.varianttestresults`      | Observation.effective                                                                   | younger than kick-off-date                   |                                                                                                                                                                                                                                                                                   |
|                                      | Observation.code                                                                        | IN (`96895-8`,`96741-4`)                     |                                                                                                                                                                                                                                                                                   |
|                                      | Observation.valueCodeableConcept                                                        |                                              | Loinc codes from [this value set](https://loinc.org/96741-4)                                                                                                                                                                                                                      |
| `cumulative.age.maxtreatmentlevel.*` | Encounter.location                                                                      |                                              | referenced `Location.type` = `ICU`                                                                                                                                                                                                                                                |
|                                      | Encounter.status                                                                        | `IN-PROGRESS`                                |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.type                                                                          | `Versorgungsstellenkontakt`                  |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.class                                                                         | `IMP`                                        |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.period.start                                                                  |                                              |                                                                                                                                                                                                                                                                                   |
|                                      | Procedure.code                                                                          |                                              | `code` from [VENTILATION](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-procedure-beatmung-snomed)/[ECMO](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-extrakorporale-verfahren) value set |
|                                      | Patient.birthDate                                                                       |                                              |                                                                                                                                                                                                                                                                                   |
| `timeline.tests`                     | Observation.effective                                                                   | younger than kick-off-date                   |                                                                                                                                                                                                                                                                                   |
|                                      | Observation.code                                                                        | IN (`94640-0`,`94306-8`,`96763-8`,`94500-6`) |                                                                                                                                                                                                                                                                                   |
|                                      | Observation.valueCodeableConcept                                                        |                                              | [MII value set](https://simplifier.net/medizininformatikinitiative-modullabor/valuesetqualitativelaborergebnisse)                                                                                                                                                                 |
| `timeline.test.positive`             | Observation.effective                                                                   | younger than kick-off-date                   |                                                                                                                                                                                                                                                                                   |
|                                      | Observation.code                                                                        | IN (`94640-0`,`94306-8`,`96763-8`,`94500-6`) |                                                                                                                                                                                                                                                                                   |
|                                      | Observation.valueCodeableConcept                                                        | IN (`10828004`,`260373001`,`52101004`)       |                                                                                                                                                                                                                                                                                   |
| `timeline.maxtreatmentlevel`         | Encounter.location                                                                      |                                              | referenced `Location.type` = `ICU`                                                                                                                                                                                                                                                |
|                                      | Encounter.location.period / Encounter.period                                            |                                              |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.type                                                                          | `Versorgungsstellenkontakt`                  |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.class                                                                         |                                              | `IMP`or `AMB`                                                                                                                                                                                                                                                                     |
|                                      | Procedure.code                                                                          |                                              | `code` from [VENTILATION](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-procedure-beatmung-snomed)/[ECMO](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-extrakorporale-verfahren) value set |
|                                      | Procedure.period                                                                        |                                              |                                                                                                                                                                                                                                                                                   |
| `timeline.varianttestresults`        | Observation.effective                                                                   | younger than kick-off-date                   |                                                                                                                                                                                                                                                                                   |
|                                      | Observation.code                                                                        | IN (`96895-8`,`96741-4`)                     |                                                                                                                                                                                                                                                                                   |
|                                      | Observation.valueCodeableConcept                                                        |                                              | Loinc codes from [this value set](https://loinc.org/96741-4)                                                                                                                                                                                                                      |
| `timeline.deaths`                    | Encounter.type                                                                          | `Einrichtungskontakt`                        |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.class                                                                         | `IMP`                                        |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.period.end                                                                    |                                              |                                                                                                                                                                                                                                                                                   |
|                                      | Encounter.hospitalization.dischargeDisposition<br>.EntlassungsgrundErsteUndZweiteStelle | `07`                                         |                                                                                                                                                                                                                                                                                   |

# Influenza

## General queries

The following queries are used at the beginning of a run to determine the patient/encounter pool.

### Retrieval input criteria

 	1) [base]/Condition?code=J10.0,J10.1,J10.8,J09&_pretty=false&date=ge2022-09-01&_count=500 
    2) [base]/Observation?code=34487-9,60416-5,49521-8,49531-7,61365-3,48509-4,29909-9,40982-1&date=ge2022-09-01

### Further data retrieval

    3) [base]/Patient?_id=[ids_from_1_and_2]
    4) [base]/Encounter?subject=[ids_from_3]&date=ge2022-09-01
    5) [base]/Location?_id=[ids_from_4]
    6) [base]/Procedure?code=26763009,243147009,[...],19647005&subject=[ids_from_1_and_2]

## Data items composition

Most of the items just rely on data with at least one positive influenza lab finding or diagnosis.

| Item name                                 | FHIR attributes                                                                         | Forced Condition                                                                         | Separation criterium                                                                                                                                                                                                                                                              |
|-------------------------------------------|-----------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `infl.current.treatmentlevel`             | Encounter.location                                                                      |                                                                                          | referenced `Location.type` = `ICU`                                                                                                                                                                                                                                                |
|                                           | Encounter.status                                                                        | `IN-PROGRESS`                                                                            |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.type                                                                          | `Versorgungsstellenkontakt`                                                              |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.class                                                                         | `IMP`                                                                                    |                                                                                                                                                                                                                                                                                   |    
|                                           | Procedure.code                                                                          |                                                                                          | `code` from [VENTILATION](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-procedure-beatmung-snomed)/[ECMO](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-extrakorporale-verfahren) value set |
|                                           | Procedure.status                                                                        |                                                                                          | `IN-PROGRESS`, `FINISHED`                                                                                                                                                                                                                                                         |
| `infl.current.maxtreatmentlevel`          | Encounter.location                                                                      |                                                                                          | referenced `Location.type` = `ICU`                                                                                                                                                                                                                                                |
|                                           | Encounter.status                                                                        | `IN-PROGRESS`                                                                            |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.type                                                                          | `Versorgungsstellenkontakt`                                                              |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.class                                                                         | `IMP`                                                                                    |                                                                                                                                                                                                                                                                                   |
|                                           | Procedure.code                                                                          |                                                                                          | `code` from [VENTILATION](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-procedure-beatmung-snomed)/[ECMO](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-extrakorporale-verfahren) value set |
| `infl.current.age.maxtreatmentlevel.*`    | Encounter.location                                                                      |                                                                                          | referenced `Location.type` = `ICU`                                                                                                                                                                                                                                                |
|                                           | Encounter.status                                                                        | `IN-PROGRESS`                                                                            |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.type                                                                          | `Versorgungsstellenkontakt`                                                              |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.class                                                                         | `IMP`                                                                                    |                                                                                                                                                                                                                                                                                   |
|                                           | Procedure.code                                                                          |                                                                                          | `code` from [VENTILATION](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-procedure-beatmung-snomed)/[ECMO](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-extrakorporale-verfahren) value set |                           
|                                           | Patient.birthDate                                                                       |                                                                                          |                                                                                                                                                                                                                                                                                   |
| `infl.cumulative.results`                 | Observation.effective                                                                   | younger than kick-off-date                                                               |                                                                                                                                                                                                                                                                                   |
|                                           | Observation.code                                                                        | IN (`34487-9`,`60416-5`,`49521-8`,`49531-7`,<br>`61365-3`,`48509-4`,`29909-9`,`40982-1`) |                                                                                                                                                                                                                                                                                   |
|                                           | Observation.valueCodeableConcept                                                        |                                                                                          | [MII value set](https://simplifier.net/medizininformatikinitiative-modullabor/valuesetqualitativelaborergebnisse)                                                                                                                                                                 |
| `infl.cumulative.gender`                  | Patient.gender                                                                          |                                                                                          | [MII AdministrativeGender value set](https://simplifier.net/packages/hl7.fhir.r4.core/4.0.1/files/80273)                                                                                                                                                                          |
| `infl.cumulative.age`                     | Patient.birthDate                                                                       |                                                                                          |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.period.start                                                                  |                                                                                          |                                                                                                                                                                                                                                                                                   |
| `infl.cumulative.maxtreatmentlevel`       | Encounter.location                                                                      |                                                                                          | referenced `Location.type` = `ICU`                                                                                                                                                                                                                                                |
|                                           | Encounter.type                                                                          | `Versorgungsstellenkontakt`                                                              | `IN-PROGRESS`, `FINISHED`                                                                                                                                                                                                                                                         |
|                                           | Encounter.class                                                                         | `IMP`                                                                                    |                                                                                                                                                                                                                                                                                   |
|                                           | Procedure.code                                                                          |                                                                                          | `code` from [VENTILATION](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-procedure-beatmung-snomed)/[ECMO](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-extrakorporale-verfahren) value set |
| `infl.cumulative.zipcode`                 | Patient.address.postalCode                                                              |                                                                                          |                                                                                                                                                                                                                                                                                   |
|                                           | Patient.address.country                                                                 |                                                                                          | `DE` or not                                                                                                                                                                                                                                                                       |
| `infl.cumulative.inpatient.gender`        | Patient.gender                                                                          |                                                                                          | [MII AdministrativeGender value set](https://simplifier.net/packages/hl7.fhir.r4.core/4.0.1/files/80273)                                                                                                                                                                          |
|                                           | Encounter.class                                                                         | `IMP`                                                                                    |                                                                                                                                                                                                                                                                                   |
| `infl.cumulative.outpatient.gender`       | Patient.gender                                                                          |                                                                                          | [MII AdministrativeGender value set](https://simplifier.net/packages/hl7.fhir.r4.core/4.0.1/files/80273)                                                                                                                                                                          |
|                                           | Encounter.class                                                                         | `AMB`                                                                                    |                                                                                                                                                                                                                                                                                   |
| `infl.cumulative.inpatient.age`           | Patient.birthDate                                                                       |                                                                                          |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.type                                                                          | `Einrichtungskontakt`                                                                    |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.period.start                                                                  |                                                                                          |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.class                                                                         | `IMP`                                                                                    |                                                                                                                                                                                                                                                                                   |
| `infl.cumulative.outpatient.age`          | Patient.birthDate                                                                       |                                                                                          |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.type                                                                          | `Einrichtungskontakt`                                                                    |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.period.start                                                                  |                                                                                          |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.class                                                                         | `AMB`                                                                                    |                                                                                                                                                                                                                                                                                   |
| `infl.cumulative.lengthofstay.icu.*`      | Encounter.location                                                                      |                                                                                          | referenced `Location.type` = `ICU`                                                                                                                                                                                                                                                |
|                                           | Encounter.location.period                                                               |                                                                                          |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.location.physicalType                                                         | `wa`                                                                                     |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.type                                                                          | `Versorgungsstellenkontakt`                                                              |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.hospitalization.dischargeDisposition<br>.EntlassungsgrundErsteUndZweiteStelle |                                                                                          | `07`                                                                                                                                                                                                                                                                              |
| `infl.cumulative.lengthofstay.hospital.*` | Encounter.type                                                                          | `Einrichtungskontakt`                                                                    |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.period                                                                        |                                                                                          |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.hospitalization.dischargeDisposition<br>.EntlassungsgrundErsteUndZweiteStelle |                                                                                          | `07`                                                                                                                                                                                                                                                                              |
| `infl.cumulative.age.maxtreatmentlevel.*` | Encounter.location                                                                      |                                                                                          | referenced `Location.type` = `ICU`                                                                                                                                                                                                                                                |
|                                           | Encounter.status                                                                        | `IN-PROGRESS`                                                                            |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.type                                                                          | `Versorgungsstellenkontakt`                                                              |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.class                                                                         | `IMP`                                                                                    |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.period.start                                                                  |                                                                                          |                                                                                                                                                                                                                                                                                   |
|                                           | Procedure.code                                                                          |                                                                                          | `code` from [VENTILATION](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-procedure-beatmung-snomed)/[ECMO](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-extrakorporale-verfahren) value set |
|                                           | Patient.birthDate                                                                       |                                                                                          |                                                                                                                                                                                                                                                                                   |
| `infl.timeline.tests`                     | Observation.effective                                                                   | younger than kick-off-date                                                               |                                                                                                                                                                                                                                                                                   |
|                                           | Observation.code                                                                        | IN (`34487-9`,`60416-5`,`49521-8`,`49531-7`,<br>`61365-3`,`48509-4`,`29909-9`,`40982-1`) |                                                                                                                                                                                                                                                                                   |
|                                           | Observation.valueCodeableConcept                                                        |                                                                                          | [MII value set](https://simplifier.net/medizininformatikinitiative-modullabor/valuesetqualitativelaborergebnisse)                                                                                                                                                                 |
| `infl.timeline.test.positive`             | Observation.effective                                                                   | younger than kick-off-date                                                               |                                                                                                                                                                                                                                                                                   |
|                                           | Observation.code                                                                        | IN (`34487-9`,`60416-5`,`49521-8`,`49531-7`,<br>`61365-3`,`48509-4`,`29909-9`,`40982-1`) |                                                                                                                                                                                                                                                                                   |
|                                           | Observation.valueCodeableConcept                                                        | IN (`10828004`,`260373001`,`52101004`)                                                   |                                                                                                                                                                                                                                                                                   |
| `infl.timeline.maxtreatmentlevel`         | Encounter.location                                                                      |                                                                                          | referenced `Location.type` = `ICU`                                                                                                                                                                                                                                                |
|                                           | Encounter.location.period                                                               |                                                                                          |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.location.physicalType                                                         | `wa`                                                                                     |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.type                                                                          | `Versorgungsstellenkontakt`                                                              |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.class                                                                         |                                                                                          | `IMP`or `AMB`                                                                                                                                                                                                                                                                     |
|                                           | Procedure.code                                                                          |                                                                                          | `code` from [VENTILATION](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-procedure-beatmung-snomed)/[ECMO](https://simplifier.net/medizininformatikinitiative-modul-intensivmedizin/vs-mii-icu-code-extrakorporale-verfahren) value set |
|                                           | Procedure.period                                                                        |                                                                                          |                                                                                                                                                                                                                                                                                   |
| `infl.timeline.deaths`                    | Encounter.type                                                                          | `Einrichtungskontakt`                                                                    |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.class                                                                         | `IMP`                                                                                    |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.period.end                                                                    |                                                                                          |                                                                                                                                                                                                                                                                                   |
|                                           | Encounter.hospitalization.dischargeDisposition<br>.EntlassungsgrundErsteUndZweiteStelle | `07`                                                                                     |                                                                                                                                                                                                                                                                                   |

# Kiradar

## General queries

The following queries are used at the beginning of a run to determine the patient/encounter pool.

### Retrieval input criteria

The codes are read dynamically from the `application.yaml`, all entries
under `global.inputcodes.kids-radar.kjp` and `global.inputcodes.kids-radar.rsv` are read.
The default list can be seen in the data set description.

    1) [base]/Condition?code=J20.5,J21.0,J12.1,...,F98.9,F99&_pretty=false&_count=200

### Further data retrieval

    2) [base]/Patient?_id=[ids_from_1]
    3) [base]/Encounter?subject=[ids_from_2]&date=gt2020-01-01&_class=IMP&_count=200

## Data items composition

The following data items are generated for all patients who were under the age of 18 at the start of
the treatment case and with at least one diagnosis per kiradar context (KJP or RSV). For the KJP
data, encounters >18 years are also considered due to possible case merges (see dataset
description).

To find out which encounters are valid, there are a few pre-filtering steps. In addition to age
checks, which are also carried out again in the items due to clustering, the analysis of the
condition diagnosis resources is mandatory. The necessary attributes are `Condition.recordedDate`
and `Condition.code.coding.code`.

| Item name                                | FHIR attributes            | Forced Condition      | Separation criterium |
|------------------------------------------|----------------------------|-----------------------|----------------------|
| `kira.kjp.cumulative.diags.zipcode`      | Patient.address.postalCode |                       |                      |
|                                          | Patient.address.country    |                       | `DE` or not          |
| `kira.kjp.cumulative.diags.age`          | Patient.birthDate          |                       |                      |
|                                          | Encounter.type             | `Einrichtungskontakt` |                      |
|                                          | Encounter.period.start     |                       |                      |
|                                          | Encounter.class            | `IMP`                 |                      |
| `kira.kjp.cumulative.diags.gender`       | Patient.gender             |                       |                      |
| `kira.kjp.cumulative.diags.lengthofstay` | Encounter.type             | `Einrichtungskontakt` |                      |
|                                          | Encounter.period           |                       |                      |
| `kira.kjp.timeline.diags.occurrence`     | Encounter.period.start     |                       |                      |
| `kira.rsv.cumulative.diags.zipcode`      | Patient.address.postalCode |                       |                      |
|                                          | Patient.address.country    |                       | `DE` or not          |
| `kira.rsv.cumulative.diags.age`          | Patient.birthDate          |                       |                      |
|                                          | Encounter.type             | `Einrichtungskontakt` |                      |
|                                          | Encounter.period.start     |                       |                      |
|                                          | Encounter.class            | `IMP`                 |                      |
| `kira.rsv.cumulative.diags.gender`       | Patient.gender             |                       |                      |
| `kira.rsv.cumulative.diags.lengthofstay` | Encounter.type             | `Einrichtungskontakt` |                      |
|                                          | Encounter.period           |                       |                      |
| `kira.rsv.timeline.diags.occurrence`     | Encounter.period.start     |                       |                      |

# Acribis

## General queries

The acribis patient pool is determined on the basis of the consent resources.

### Retrieval input criteria

The codes are read dynamically from the `application.yaml`, all entries
under `global.inputcodes.kids-radar.kjp` and `global.inputcodes.kids-radar.rsv` are read.
The default list can be seen in the data set description.

    1) [base]/Consent?category=https://www.medizininformatik-initiative.de/fhir/modul-consent/CodeSystem/mii-cs-consent-consent_category|2.16.840.1.113883.3.1937.777.24.2.184&date=ge2024-10-01

### Further data retrieval

    Not implemented yet.

## Data items composition

The following attributes are checked to detect valid (acribis) consent resources:

| Resource.attribute                         | Forced Condition                                                                                                           | Separation criterium |
|--------------------------------------------|----------------------------------------------------------------------------------------------------------------------------|----------------------|
| `Consent.category[0].system`               | `http://loinc.org`                                                                                                         |                      |
| `Consent.category[0].code`                 | `57016-8`                                                                                                                  |                      |
| `Consent.category[1].system`               | `https://www.medizininformatik-initiative.de/fhir/modul-consent/CodeSystem/mii-cs-consent-consent_category`                |                      |
| `Consent.category[1].code`                 | `2.16.840.1.113883.3.1937.777.24.2.184`                                                                                    |                      |
| `Consent.patient`                          |                                                                                                                            |                      |
| `Consent.policy`                           | `urn:oid:2.16.840.1.113883.3.1937.777.24.2.1790` (main form) or `urn:oid:2.16.840.1.113883.3.1937.777.24.2.4031` (acribis) |                      |
| `Consent.provision.provision.type`         | `PERMIT`                                                                                                                   |                      |
| `Consent.provision.provision.period.start` | `>= 01.10.2024`                                                                                                            |                      |
| `Consent.provision.provision.code.system`  | `urn:oid:2.16.840.1.113883.3.1937.777.24.5.3`                                                                              |                      |
| `Consent.provision.provision.code.code`    | `2.16.840.1.113883.3.1937.777.24.5.3.57`                                                                                   |                      |

If additional special checks exist within the data items, these are listed here:

| Item name                  | FHIR attributes                          | Forced Condition | Separation criterium |
|----------------------------|------------------------------------------|------------------|----------------------|
| `acr.current.recruitment`  |                                          |                  |                      |
| `acr.timeline.recruitment` | Consent.provision.provision.period.start |                  |                      |
